%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Non mathematical macros

% Notes

\RequirePackage{soul} %for highlighting, strinking out, etc
\RequirePackage{todonotes}
\RequirePackage[dvipsnames]{xcolor}

\DeclareRobustCommand{\hlcolor}[2]{{\sethlcolor{#2}\hl{#1}}}

\makeatletter
\if@todonotes@disabled
\newcommand{\todohl}[3]{#2}
\else
\newcommand{\todohl}[3]{\hlcolor{#1}{#2}\todo[color=#1,size=\footnotesize]{#3}}
\fi
\makeatother

\newcommand{\note}[4]{\todohl{#2}{#3}{\fbox{\bfseries#1} #3}}

\newcommand{\mlb}[2]{\note{MLB}{red!80!yellow}{#1}{#2}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% General maths

% Symbols

\RequirePackage{mathtools} % Subsumes the following
% \RequirePackage{amsmath}
% \RequirePackage{amssymb}
% \RequirePackage{amsfonts}
\RequirePackage{stmaryrd} % More symbols
\RequirePackage{dsfont} % More double-struck stuff

\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\phi}{\varphi}

% Tikz and friends

\RequirePackage{tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{cd}
\usetikzlibrary[patterns]

% Colors in math mode, with correct spacing
% https://tex.stackexchange.com/questions/21598/how-to-color-math-symbols

\makeatletter

\def\mathcolor#1#{\@mathcolor{#1}}
\def\@mathcolor#1#2#3{%
	\protect\leavevmode
	\begingroup
    \color#1{#2}#3%
  \endgroup
}

\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Induction rules

\usepackage{mathpartir}
\renewcommand{\TirNameStyle}{\textsc} %style of the induction rule name for mathpartir

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Reference to inference rules, inspired by https://tex.stackexchange.com/questions/340788/cross-referencing-inference-rules

\makeatletter

\NewDocumentCommand \mpr@label { m }{%
	\def\@currentlabelname{#1}%
  \phantomsection % Creating an anchor to get a correct hyper reference link
}

\DeclareDocumentCommand \inferdef {m m m}{%
  \inferrule*[vcenter,right=#1]{#2}{#3}
  \mpr@label{\textsc{#1}}
}%

\DeclareDocumentCommand \redrule {o m m}{%
	\IfValueTF{#1}
	{\textsc{#1}: \; #2 \redCCIC #3 \mpr@label{\textsc{#1}}}
	{#2 \redCCIC #3}
}

\makeatother

\newcommand{\ruleref}[1]{Rule~\nameref{#1}}

%mathpar hack, inspired by http://lists.seas.upenn.edu/pipermail/types-list/2019/002157.html

\newcommand{\maflushleft}{\strut \and \hfill}

\newcommand{\jform}[1]{\boxed{#1}\maflushleft\\}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Type theoretic stuff

%% Contexts
\newcommand{\emptycon}{\cdot}

\newcommand{\subs}[3]{#1\{#2 := #3\}}

%% Terms

%See https://tex.stackexchange.com/questions/477662/fontspec-breaks-capital-greek-letters-in-declaremathoperator?rq=1
\let\l\relax
\DeclareMathOperator{\l}{λ}

\let\P\relax
\DeclareMathOperator{\P}{Π}

%% Universes

\DeclareDocumentCommand\uni{o}{\square\IfValueT{#1}{_{#1}}}
\newcommand{\umaxsymb}{\max}
\newcommand{\unextsymb}{+1}
\DeclareDocumentCommand\unext{m}{#1+1}
\DeclareDocumentCommand\umax{m m}{\max(#1,#2)}

%% Inductive Types

\DeclareMathOperator{\Vect}{Vect}

\newcommand{\?}{\mathbb{?}}

%% Conversion
\newcommand{\conv}{\cong}